<?xml version="1.0" encoding="UTF-8"?>
<!-- This document was created with Syntext Serna Free. -->
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN"
"topic.dtd">
<topic id="template_id">
  <title>In Circuit Programming</title>

  <prolog>
    <author>Matthew Schinkel</author>

    <publisher>Jallib Group</publisher>

    <metadata>
      <category/>

      <prodinfo>
        <prodname>Jallib</prodname>

        <vrmlist>
          <vrm version="0.0"/>
        </vrmlist>
      </prodinfo>
    </metadata>
  </prolog>

  <body>
    <p id="firstcontent">This tutorial introduces in-circuit serial programming (ICSP) for PIC microcontrollers and explains how to integrate it into your hardware.</p>

    <section><title>What is ICSP?</title><p>In-Circuit Serial Programming (ICSP) lets you load firmware onto a PIC while it remains in the circuit. The programmer communicates through a small header, so there is no need to remove the device from the board each time you make a change.</p><p>For Microchip's formal definition of the protocol, see <xref format="html"
    href="http://ww1.microchip.com/downloads/en/DeviceDoc/30277d.pdf"
    scope="external">Microchip's ICSP Programming Specification</xref>.</p></section>

    <section><title>Benefits of ICSP</title><p>ICSP streamlines development by letting you:</p><ol>
        <li>Program your PIC while it remains on a breadboard circuit</li>

        <li>Program your PIC after it is soldered into a finished board</li>

        <li>Load new firmware quickly so you can iterate on code faster</li>

        <li>Reset the circuit directly from your development PC</li>

        <li>Work with surface-mount PIC devices without removing them</li>

        <li>Avoid bending or breaking pins from repeated insertion</li>

        <li>Prevent damage caused by misaligning the PIC in a socket or breadboard</li>

        <li>Program a remote project using tools such as VNC</li>

        <li>Stay comfortable while developing - my favorite setup is programming from the couch while the hardware stays in the lab</li>
      </ol></section>

    <section><title>Intro to ICSP &amp; in-circuit programming</title><p>When I first started working with microcontrollers and JAL, I chose a programmer at random from an online auction site. It supported many PIC devices, which seemed good enough at the time.</p><p>For years I removed a PIC16F877 from my breadboard, programmed it, and then placed it back into the circuit. That routine bent pins and cost a lot of development time. I eventually noticed the programmer had an ICSP output - the front panel even said "ICSP" - but I still did not understand how to use it.</p><p>After hearing more about ICSP, I examined the six-pin header on the programmer. The connections were poorly labeled, so I used a multimeter, a logic probe, and occasionally an oscilloscope to watch each pin while programming. Pin 3 was clearly ground, and pin 6 appeared unused. If you already know your programmer's ICSP pinout, feel free to skip ahead to the circuit diagrams.</p><p>Because ICSP pin assignments vary by programmer, I measured the signals while a chip was idle and again during programming. The readings looked like this:</p><p><table frame="all">
        <tgroup cols="3">
          <thead>
            <row>
              <entry>PIN #</entry>

              <entry>While Idle</entry>

              <entry>While Programming</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>1</entry>

              <entry>0v</entry>

              <entry>12v</entry>
            </row>

            <row>
              <entry>2</entry>

              <entry>0v</entry>

              <entry>5v</entry>
            </row>

            <row>
              <entry>3</entry>

              <entry>0v</entry>

              <entry>0v</entry>
            </row>

            <row>
              <entry>4</entry>

              <entry>5v</entry>

              <entry>Pulsing 0v to 5v (random)</entry>
            </row>

            <row>
              <entry>5</entry>

              <entry>0v</entry>

              <entry>Pulsing 0v to 5v (square wave)</entry>
            </row>

            <row>
              <entry>6</entry>

              <entry>not connected</entry>

              <entry>0v - can see no connection on PCB</entry>
            </row>
          </tbody>
        </tgroup>
      </table></p></section>

    <section><title>Get the pin names</title><p>The typical ICSP signals are VPP (program enable), VDD (target power), GND, PGD (data), PGC (clock), and an optional AUX or PGM pin. Matching these names to the voltages above reveals which signal each physical pin carries:</p><p>Pin 6 stays at 0 V, so it must be the unused AUX/PGM pin.</p><p>Pin 3 is the ground reference.</p><p>Pin 1 rises to about 12 V during programming, indicating VPP.</p><p>Pin 2 provides 5 V to the target, so it is VDD.</p><p>Pins 4 and 5 pulse while programming; they correspond to PGD (data) and PGC (clock). If all you have is a multimeter, you may need to guess which is which and confirm with a data sheet.</p><p>Most six-pin ICSP connectors follow this mapping:</p><table frame="all">
        <tgroup cols="4">
          <thead>
            <row>
              <entry>PIN #</entry>

              <entry>PIN NAME</entry>

              <entry>While idle</entry>

              <entry>While Programming</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry>1</entry>

              <entry>VPP</entry>

              <entry>0v</entry>

              <entry>12v</entry>
            </row>

            <row>
              <entry>2</entry>

              <entry>VDD</entry>

              <entry>0v</entry>

              <entry>5v</entry>
            </row>

            <row>
              <entry>3</entry>

              <entry>GND</entry>

              <entry>0v</entry>

              <entry>0v</entry>
            </row>

            <row>
              <entry>4</entry>

              <entry>PGD</entry>

              <entry>5v</entry>

              <entry>Pulsing 0v to 5v (random)</entry>
            </row>

            <row>
              <entry>5</entry>

              <entry>PGC</entry>

              <entry>0v</entry>

              <entry>Pulsing 0v to 5v (square wave)</entry>
            </row>

            <row>
              <entry>6</entry>

              <entry>AUX/PGM</entry>

              <entry>not connected</entry>

              <entry>not connected</entry>
            </row>
          </tbody>
        </tgroup>
      </table></section>

    <section><title>Build a circuit with ICSP</title><p>You can tie the ICSP VDD pin to your circuit's 5 V rail, as shown in the simplified schematic below. Some programmers supply power on this pin while others expect the target to provide its own supply. If your programmer does not require VDD, disconnect the wire once everything is working.</p><p>I rarely rely on power-off programming because my projects draw too much current when the supply is removed. Instead, I keep the circuit powered and let the programmer share the same ground.</p><p>GND must always connect to the project ground. Follow one of the schematics below to wire the header:</p> <image
    href="images/ICSP_Simple.png" otherprops="clickable" width="450"/><note>This simplified schematic omits the reset button; the detailed version below includes it.</note> <image
    href="images/icsp_circuit.jpg" otherprops="clickable" width="450"/>
    <p>You're ready to go - apply power to the circuit and try programming your PIC.</p></section>
  </body>
</topic>

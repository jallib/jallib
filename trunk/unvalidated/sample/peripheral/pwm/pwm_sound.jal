-- Title: Sample using hardware (built-in) PWM. Plays sound
-- Author: Sebastien Lelong, Copyright (c) 2008, all rights reserved.
-- Adapted-by:
-- Compiler: >=2.4g
-- 
-- This file is part of jallib (http://jallib.googlecode.com)
-- Released under the BSD license (http://www.opensource.org/licenses/bsd-license.php)
--
-- Description: this sample show how to use PWM with a constant duty cycle and 
-- a variable frequency. It plays a "nice" melody (connect a small piezzo)
-- Frequencies from 0 to 100_000Hz are played. At the beginning, no sound will come
-- the buzzer, because frequency is too low (no valid combination of PR2/T2CON)
--
-- 
--

-- select chip
include 16f88
-- set all IO as digital
enable_digital_io()

-- We'll use internal oscillator. It work @ 8MHz
pragma target clock		8_000_000
pragma target OSC		INTOSC_NOCLKOUT
-- no watchdog, please
pragma target WDT		disabled

-- Configure PWM
pragma target CCP1MUX	RB0
pin_b0_direction = output
include pwm_ccp1
-- Let's go !!!
pwm1_on()


var dword counter = 0
forever loop

	-- Setting @50% gives max volume
	pwm1_set_percent_dutycycle(50)
	for 100_000 using counter loop
		pwm_set_frequency(counter)
	end loop

end loop



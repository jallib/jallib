Jallib Release Instructions
===========================

Prerequisites: DITA_HOME set (e.g. path to dita-ot for PDF docs). Optional: wine, xvfb for Windows installer build. JalEdit zip in Release_Files/jaledit0.9.0.9.zip.

1. From the tools directory, run "python torelease.py" to get a list of unreleased libraries and samples.
   Set JALLIB to your local jallib directory (or edit the script path). Post the list on the Jallib Google group.

2. Clone the jallib repository from GitHub if you haven't already.
   git clone https://github.com/jallib/jallib.git

3. Set environment variables (adjust paths to your setup)
   A. export JALLIB_DIR=<path-to-your-jallib-repo>
   B. export DITA_HOME=<path-to-dita-ot>   # required for release (PDF books)
   Optional for Windows installer on Linux: wine, xvfb; WINEARCH=win32. Installer build times out after 30 min; if it hangs, build the .exe on Windows.

4. Update CHANGELOG with the new version
   A. git -C $JALLIB_DIR pull
   B. git -C $JALLIB_DIR clean -f
   C. git -C $JALLIB_DIR restore $JALLIB_DIR
   D. Edit CHANGELOG (e.g. pico CHANGELOG)
   E. git add CHANGELOG
   F. git commit

5. Build packages (from $JALLIB_DIR/tools/)
   A. make release VERSION=<the_version> 2>&1 | tee <the_version>.log
      Example: make release VERSION=2.0.0beta 2>&1 | tee 2.0.0beta.log
   Output in tools/distrib/:
   - jallib-<VERSION>.zip
   - jallib_full-<VERSION>.zip

   For release plus Windows installer (requires wine, xvfb):
   - make release-win VERSION=<the_version>
   Adds: jallib_full_win_setup-<VERSION>.exe in distrib/
   The Wine+Aut2exe step times out after 30 min (WIN_INSTALLER_TIMEOUT=1800). If it times out or hangs, build the .exe on Windows: copy tools/JallibWinSetup (and put the zip in files/jallib-pack.zip), then run Aut2exe.exe there.

6. Publish packages to the download location (steps 6-7)
   From $JALLIB_DIR/tools/:
   A. make publish-release  (copies to PUBLISH_DIR_RELEASE, default builds/release). Override with PUBLISH_DIR_RELEASE=<path>.
   B. Publish copies all distrib/*.zip and distrib/*.exe. Run "make release" (or release-win) first so distrib/ exists.
   Optional manual copy instead:
   cp $JALLIB_DIR/tools/distrib/*.zip <your-download-dir>/
   cp $JALLIB_DIR/tools/distrib/*.exe <your-download-dir>/   # if you built the installer

7. Ensure the files are available on jallib downloads (e.g. sync or upload if the publish destination is not the live server)

8. Announce mail to jallib, including <the_version>.log file !!!
   (Manual step; do not do this from the Makefile.)

9. Make a release on GitHub
    Go to GitHub and jallib, then 'Releases'.
    Create a new release: set tag (e.g. Jallib_1.4.0), title (e.g. Release of Jallib 1.4.0), description from CHANGELOG.
    Publish Release (optionally mark as pre-release for betas).


Example file names to release (beta):
  jallib-2.0.0beta4.zip
  jallib_full-2.0.0beta4.zip
  jallib_full_win_setup-2.0.0beta4.exe

Example file names to release (final):
  jallib-2.0.0.zip
  jallib_full-2.0.0.zip
  jallib_full_win_setup-2.0.0.exe
